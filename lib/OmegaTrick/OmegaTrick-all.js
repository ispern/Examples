Ext.ns("Ext.trick","Ext.trick.app");
Ext.trick.app.Entry=function(){var me=this,leaveCheck=false,apps={};return{add:function(app){var id=Ext.id(null,"OmegaTrickApp");apps[id]=new app;if(apps[id].appName){if(!window[apps[id].appName])window[apps[id].appName]={};Ext.applyIf(window[apps[id].appName],apps[id])}else{window[id]=apps[id];apps[id].appName=id}},remove:function(id){if(aps[id])delete apps[id]},removeLoadingMask:function(){var mask=Ext.get("OMEGATRICK_LOADINGMASK"),logo=Ext.get("OMEGATRICK_LOADING_LOGO"),progress=Ext.get("OMEGATRICK_LOADING_PROGRESS");
if(logo)logo.fadeOut();if(progress)progress.fadeOut({callback:function(){progress.remove();if(mask)mask.fadeOut()}})},showLoadText:function(o){var wrap=Ext.get("OMEGATRICK_LOADING_PROGRESS"),config=o||{};if(config.anim===false)wrap.show();else wrap.fadeIn(config)},hideLoadText:function(o){var wrap=Ext.get("OMEGATRICK_LOADING_PROGRESS"),config=o||{};if(config.anim===false)wrap.hide();else wrap.fadeOut(config)},updateLoadText:function(text){var wrap=Ext.get("OMEGATRICK_LOADING_PROGRESS"),to=Ext.get("OMEGATRICK_LOADING_PROGRESS_MSG"),
tm=Ext.util.TextMetrics.createInstance(wrap),width=tm.getWidth(text)+10;wrap.setWidth(width);wrap.setStyle({marginLeft:"-"+width/2+"px"});to.update(text)},setLeaveMessage:function(msg){me.leaveCheck=msg},boot:function(){window.onbeforeunload=function(){if(me.leaveCheck)return me.leaveCheck};Ext.iterate(apps,function(key,item,items){item.init()})}}}();Ext.onReady(Ext.trick.app.Entry.boot);Ext.onTrick=function(o){return Ext.trick.app.Entry.add(Ext.extend(Ext.trick.app.App,o))};Ext.ns("Ext.trick","Ext.trick.app","Ext.trick.layout","Ext.trick.unit","Ext.trick.util");
Ext.trick.app.App=Ext.extend(Ext.util.Observable,{appName:null,autoRender:true,screenXTypePrefix:"",useHistory:{tokenDelimiter:":"},widgets:{},screens:[],casing:{},initEvents:function(){var me=this,cp=me.cp,akey=cp.get("autosigninkey");me.addEvents("beforeinit","init","beforestart","start","beforeloadscript","loadscript");me.on("init",me.removeScriptTags,me);if(me.auth)if(akey)me.on("init",me.doAutoSignin);else me.on("init",me.doAuth);else{me.on("init",Ext.trick.app.Entry.removeLoadingMask);if(me.autoRender)me.on("init",
me.render,me);else me.on("init",me.start,me)}},signout:function(o){var me=this,config=o||{},arg=[],auth=eval(me.auth.directFn);if(config.callback){arg.push(config.callback);if(config.scope)arg.push(config.scope)}auth.signout.apply(me,arg)},doAutoSignin:function(){var me=this,cp=me.cp,akey=cp.get("autosigninkey");auth=eval(me.auth.directFn);auth.autoSignin(akey,function(ret){if(ret.success)cp.set("autosigninkey",ret.auto_signin_key);else;me.doAuth()},me)},doAuth:function(){var me=this,cp=me.cp,akey=
cp.get("autosigninkey");auth=eval(me.auth.directFn);Ext.trick.app.Entry.updateLoadText("\u8a8d\u8a3c\u78ba\u8a8d\u4e2d...");auth.isSignin(function(ret){if(!ret)Ext.trick.app.Entry.hideLoadText({anim:true,callback:function(){me.widgets.signin=new Ext.trick.SigninWindow;me.widgets.signin.on("hide",function(ret){var autoSignin=ret.autoSignin;Ext.trick.app.Entry.updateLoadText("\u8a8d\u8a3c\u78ba\u8a8d\u4e2d...");Ext.trick.app.Entry.showLoadText({anim:true,callback:function(){auth.execute(ret,function(ret){Ext.trick.app.Entry.hideLoadText({anim:true,
callback:function(){if(ret.success){if(autoSignin)cp.set("autosigninkey",ret.auto_signin_key);Ext.trick.app.Entry.removeLoadingMask();if(me.autoRender)me.render();else me.start()}else{Ext.trick.app.Entry.hideLoadText();Ext.MessageBox.show({title:Ext.trick.SigninWindow.msg.signin.title,msg:Ext.trick.SigninWindow.msg.signin.auth.error,buttons:Ext.MessageBox.OK,modal:false,fn:function(){me.widgets.signin.show()},icon:Ext.MessageBox.ERROR})}},scope:me})},me)},scope:me})},me);me.widgets.signin.show()},
scope:me});else{Ext.trick.app.Entry.removeLoadingMask();if(me.autoRender)me.render();else me.start()}})},removeScriptTags:function(){var me=this;Ext.select("body script").each(function(el){Ext.removeNode(Ext.getDom(el))},me)},screenTo:function(to){var me=this,sp=Ext.getCmp(me.appName+"_SCREEN"),t;if(Ext.isNumber(to))Ext.iterate(sp.initialConfig.items,function(item,cnt,items){if(to===cnt)t=item});if(Ext.isString(to))Ext.iterate(sp.initialConfig.items,function(item,cnt,items){if(to===item.id)t=item});
if(me.useHistory)Ext.History.add(t.name||t.id);else sp.layout.setActiveItem(to)},directlink:function(){var me=this,anchor=location.hash;if(Ext.isString(anchor)&&anchor.startsWith("#")){anchor=anchor.substr(1);var tokens=anchor.split(me.useHistory.tokenDelimiter),sp=Ext.getCmp(me.appName+"_SCREEN");sp.layout.setActiveItem(tokens[0])}},init:function(){var me=this;Ext.QuickTips.init();if(me.useHistory){if(!Ext.isObject(me.useHistory))me.useHistory=Ext.trick.Config.getDefault("useHistory");Ext.DomHelper.append(Ext.getBody(),
{tag:"form",id:"history-form",cls:"x-hidden",cn:[{tag:"input",type:"hidden",id:"x-history-field"},{tag:"iframe",id:"x-history-frame"}]});Ext.History.init();Ext.History.on("change",function(token){var sp=Ext.getCmp(me.appName+"_SCREEN");if(Ext.isString(token))sp.layout.setActiveItem(token)})}me.cp=new Ext.state.CookieProvider({expires:new Date((new Date).getTime()+1E3*60*60*24*7)});me.initEvents();if(!me.fireEvent("beforeinit"))return false;if(me.useDirect)Ext.Direct.addProvider(me.useDirect);me.fireEvent("init")},
render:function(){var me=this,renderItems;var screens=[];Ext.iterate(me.screens,function(item,cnt,items){var o={name:item.name,xtype:me.screenXTypePrefix+item.name.toLowerCase()};if(item.items)o.scriptItems=item.items;if(item.fix)o.fix=true;if(item.id)o.id=item.id;screens.push(o)},me);renderItems=[{id:me.appName+"_SCREEN",xtype:"screen",items:screens,region:"center"}];if(Ext.isObject(me.casing)&&me.casing.north){var north=me.casing.north;north.region="north";renderItems.push(north)}if(Ext.isObject(me.casing)&&
me.casing.west){var west=me.casing.west;west.region="west";renderItems.push(west)}if(Ext.isObject(me.casing)&&me.casing.east){var east=me.casing.east;east.region="east";renderItems.push(east)}if(Ext.isObject(me.casing)&&me.casing.south){var south=me.casing.south;south.region="south";renderItems.push(south)}me.viewport=new Ext.Viewport({layout:"fit",items:[{border:false,layout:"border",items:renderItems}],listeners:{afterrender:{fn:function(){me.directlink();me.start.call(me)}}}})},start:Ext.emptyFn});Ext.trick.SigninWindow=Ext.extend(Ext.Component,{initComponent:function(){var me=this;Ext.applyIf(me,{id:Ext.id(),baseCls:"tx-signin",duration:0.3,distance:75});me.layer=new Ext.Layer({id:me.id,cls:me.baseCls});Ext.apply(me,{id:Ext.id(),bwrapCls:me.baseCls+"-bwrap",bodyCls:me.baseCls+"-body",innerCls:me.baseCls+"-inner",itemsCls:me.baseCls+"-items",headerCls:me.baseCls+"-header",contentCls:me.baseCls+"-content",renderTo:me.layer});Ext.EventManager.onWindowResize(me.onWindowResize,me);Ext.trick.SigninWindow.superclass.initComponent.call(me)},
initEvents:function(){},onRender:function(ct,position){var me=this,dh=Ext.DomHelper;Ext.trick.SigninWindow.superclass.onRender.call(me,ct,position);var el=me.el;el.addClass(me.bwrapCls);var t=new Ext.Template('<div class="{bodyCls}">','   <div class="{innerCls}">','       <div class="clearfix">','           <div id={itemsId} class="{itemsCls} clearfix">','               <div class="{headerCls}">','                   <div class="title"></div>',"               </div>",'               <div class="clearfix">',
'                   <div class="{contentCls}">','                       <div class="form">','                           <div class="mail">','                               <div class="label"></div>',"                           </div>",'                           <div class="textfield space" id="{emailId}"></div>','                           <div class="pass">','                               <div class="label"></div>',"                           </div>",'                           <div class="textfield space" id="{passId}"></div>',
"                        </div>",'                        <div class="autologin clearfix">','                            <div class="auto" id="{checkboxId}"></div>','                            <div class="btn_siginin" id="{submitId}"></div>',"                        </div>",'                        <div class="fogetpass clearfix">','                            <a href="#" class="fogetpass">{msgFogetPass}</a>',"                        </div>","                    </div>","                </div>",
"           </div>","       </div>","   </div>","</div>");t.append(el,{bodyCls:me.bodyCls,innerCls:me.innerCls,itemsCls:me.itemsCls,headerCls:me.headerCls,contentCls:me.contentCls,itemsId:el.id+"_SIGNIN_ITEMS",emailId:el.id+"_FIELD_EMAIL",passId:el.id+"_FIELD_PASSWORD",checkboxId:el.id+"_FIELD_CHECKBOX",submitId:el.id+"_FIELD_SUBMIT",msgFogetPass:Ext.trick.SigninWindow.msg.signin.fogetpass});Ext.fly(el.id+"_SIGNIN_ITEMS").setOpacity(0);me.email=new Ext.form.TextField({width:280,height:28,tabIndex:1,
vtype:"email",enableKeyEvents:true,validationEvent:false,validator:function(v){if(v=="")return Ext.trick.SigninWindow.msg.signin.validate.email;return true},listeners:{keypress:{fn:function(field,e){if(e.getKey()===e.ENTER)me.onSignin()},scope:me}},renderTo:Ext.get(el.id+"_FIELD_EMAIL")});me.password=new Ext.form.TextField({width:280,height:28,inputType:"password",tabIndex:2,enableKeyEvents:true,listeners:{keypress:{fn:function(field,e){if(e.getKey()===e.ENTER)me.onSignin()},scope:me}},renderTo:Ext.get(el.id+
"_FIELD_PASSWORD")});me.autosignin=new Ext.form.Checkbox({boxLabel:Ext.trick.SigninWindow.msg.signin.autosignin,tabIndex:3,renderTo:Ext.get(el.id+"_FIELD_CHECKBOX")});me.submit=new Ext.Button({text:Ext.trick.SigninWindow.msg.signin.submit,width:100,type:"submit",tabIndex:4,plugins:["focusactive"],handler:me.onSignin,scope:me,renderTo:el.id+"_FIELD_SUBMIT"});this.rendered=true;me.initEvents()},onSignin:function(){var me=this;me.email.disable();me.password.disable();me.hide()},getCenterPosition:function(){var me=
this,vs=Ext.getDoc().getViewSize();return{x:(vs.width-me.layer.getWidth())/2,y:(vs.height-me.layer.getHeight())/2}},show:function(){var me=this,cp=me.getCenterPosition();me.layer.setLeft(cp.x+me.distance);me.layer.setTop(cp.y);me.layer.setOpacity(0);me.layer.show();me.layer.shift({x:cp.x,easing:"easeOutStrong",opacity:1,duration:me.duration,callback:function(){Ext.fly(me.el.id+"_SIGNIN_ITEMS").fadeIn({duration:me.duration,callback:function(){me.email.enable();me.password.enable();me.email.focus();
me.fireEvent("show",me)}})}})},hide:function(){var me=this,cp=me.getCenterPosition();me.layer.shift({x:cp.x-me.distance,easing:"easeOutStrong",opacity:0,duration:me.duration,callback:function(){Ext.fly(me.el.id+"_SIGNIN_ITEMS").setOpacity(0);me.fireEvent("hide",{email:me.email.getValue(),pass:me.password.getValue(),autoSignin:me.autosignin.getValue()},me)}})},onWindowResize:function(w,h){var me=this,vs=Ext.getDoc().getViewSize(),cwp=(vs.width-me.layer.getWidth())/2,chp=(vs.height-me.layer.getHeight())/
2;if(me.isVisible){me.layer.setLeft(cwp);me.layer.setTop(chp)}}});
Ext.trick.SigninWindow.msg={signin:{title:"\u30b5\u30a4\u30f3\u30a4\u30f3",progress:"\u30b5\u30a4\u30f3\u30a4\u30f3\u4e2d...",fogetpass:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u304a\u5fd8\u308c\u3067\u3059\u304b ?",autosignin:"\u6b21\u56de\u304b\u3089\u81ea\u52d5\u30b5\u30a4\u30f3\u30a4\u30f3",submit:"\u30b5\u30a4\u30f3\u30a4\u30f3",auth:{error:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u9055\u3044\u307e\u3059\u3002"},validate:{email:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}}};Ext.ns("Ext.trick","Ext.trick.plugins");Ext.ns("Ext.trick","Ext.trick.plugins");
Ext.trick.plugins.FocusActive=function(){var me=this;var overCls="x-btn-over";var active=false;me.init=function(btn){btn.on({afterrender:{fn:function(){me.targetEl=btn.el;btn.btnEl.on("focus",me.onFocus,me);btn.btnEl.on("blur",me.onBlur,me)},scope:me},mouseout:{fn:function(){if(active)me.targetEl.addClass(overCls)},scope:me}})};me.onFocus=function(e,t){active=true;me.targetEl.addClass(overCls)};me.onBlur=function(e,t){me.targetEl.removeClass(overCls);active=false}};Ext.preg("focusactive",Ext.trick.plugins.FocusActive);Ext.ns("Ext.trick","Ext.trick.util");Ext.trick.util.Clone=function(o){if(!o||"object"!==typeof o)return o;var c="[object Array]"===Object.prototype.toString.call(o)?[]:{};var p,v;for(p in o)if(o.hasOwnProperty(p)){v=o[p];if(v&&"object"===typeof v)c[p]=Ext.trick.util.Clone(v);else c[p]=v}return c};Ext.ns("Ext.trick","Ext.trick.util");Ext.ns("Ext.trick","Ext.trick.util");Ext.trick.util.ScriptLoader=function(config){var me=this;Ext.apply(me,config);me.initEvents();Ext.trick.util.ScriptLoader.superclass.constructor.call(me)};
Ext.extend(Ext.trick.util.ScriptLoader,Ext.util.Observable,{initEvents:function(){this.addEvents("load","next")},load:function(){var me=this,load=false;if(Ext.isObject(me.items)){me.items=[me.items];load=true}var item=me.items.shift();if(item)me._load(item);else me.fireEvent("load",me)},_load:function(item){var me=this;var te=me.renderTo||document.body||document.documentElement;var script=document.createElement("script");script.id=item.id||Ext.id();script.src=item.src;script.type=item.type||"text/javascript";
if(item.charset)script.charset=item.charset;if(Ext.isIE)script.onreadystatechange=function(){switch(script.readyState){case "complete":case "loaded":if(item.callback)item.callback.apply(item.scope||me,[script.id,me]);me.load();break;default:break}};Ext.get(te.appendChild(script)).on("load",function(e,t){if(item.callback)item.callback.apply(item.scope||me,[script.id,me]);me.load()},me)}});Ext.Component.prototype.initRef=Ext.Component.prototype.initRef.createSequence(function(){var me=this;var getOwner=function(base,arr){var ret,name=arr.pop();ret=base[name];if(!ret){base[name]={};ret=base[name]}if(arr.length>0)getOwner(ret,arr);return ret};if(Ext.isString(me.refName)&&me.refName.indexOf(".")>0&&me.refOwner){var temp=me.refName.split(".");var refName=temp.pop();var owner=getOwner(me.refOwner,temp);owner[refName]=me;delete me.refOwner[me.refName]}});Ext.ns("Ext.trick","Ext.trick.form");
Ext.trick.form.FormPanel=Ext.extend(Ext.form.FormPanel,{defaultType:"container",forms:{},initComponent:function(){var me=this;me.on("beforerender",me.onBeforeRender,me);me.on("afterrender",me.onAfterRender,me);Ext.trick.form.FormPanel.superclass.initComponent.apply(me,arguments)},initEvents:function(){var me=this;Ext.trick.form.FormPanel.superclass.initEvents.apply(me,arguments)},onAfterRender:function(){var me=this;me.scanFormItems(me.items)},onBeforeRender:function(){var me=this;me.setDeepLayout(me.initialConfig.items)},
setDeepLayout:function(items){var me=this;Ext.each(items,function(item,cnt,items){if(!item.layout)item.layout="form";if(item&&item.items&&item.items.length>0)me.setDeepLayout(item.items)},me)},scanFormItems:function(items){var me=this;items.each(function(item,index,length){var setkey=item.name||item.itemId||item.id;if(item instanceof Ext.form.Field)me.forms[setkey]=item;if(!(item instanceof Ext.form.CompositeField)&&item.items&&item.items.getCount()>0)me.scanFormItems(item.items);else if(item instanceof
Ext.form.CompositeField)item.on("afterrender",function(field){Ext.iterate(field.items.items,function(item,cnt,items){var src=me.forms[setkey];src.forms=src.forms||{};var forms=src.forms;forms[item.name||item.itemId||item.id]=src.items.items[cnt]})});else if(item instanceof Ext.Button){me.formButtons=me.formButtons||{};me.formButtons[setkey]=item}},me)}});Ext.reg("advform",Ext.trick.form.FormPanel);Ext.ns("Ext.trick","Ext.trick.layout");
Ext.trick.layout.ScreenLayout=Ext.extend(Ext.layout.FitLayout,{deferredRender:false,layoutOnCardChange:false,renderHidden:true,constructor:function(config){Ext.trick.layout.ScreenLayout.superclass.constructor.apply(this,arguments)},destroyFlexItems:function(){var me=this,c=me.container,ci=c.items,ic=c.initialConfig,ici=ic.items;Ext.iterate(ci.items,function(item,cnt,items){if(!item.fix)item.destroy();else item.hide()})},setContainer:function(ct){var me=this;Ext.trick.layout.ScreenLayout.superclass.setContainer.call(me,
ct)},setActiveItem:function(item){var me=this,c=me.container,ci=c.items,ic=c.initialConfig,ici=ic.items,ai=me.activeItem,oi=item;var si;me.destroyFlexItems();if(Ext.isNumber(item))if(ci.items[item])si=ci.items[item];else si=c.add(ici[item]);else if(Ext.isString(item)){var id=item;Ext.iterate(ci.items,function(item,cnt,items){if(item.id===id)si=item});if(!si)Ext.iterate(ici,function(item,cnt,items){if(item.id===id)si=c.add(item)})}else{var target=item;Ext.iterate(ci.items,function(item,cnt,items){if(item===
target)si=item})}if(si){si.show();me.activeItem=si}me.layout();if(si){si.doLayout();si.fireEvent("activate",si)}},renderAll:function(ct,target){var me=this;if(me.deferredRender)me.renderItem(me.activeItem,undefined,target);else Ext.trick.layout.ScreenLayout.superclass.renderAll.call(me,ct,target)}});Ext.Container.LAYOUTS.screen=Ext.trick.layout.ScreenLayout;Ext.ns("Ext.trick");
Ext.trick.ScreenPanel=Ext.extend(Ext.Panel,{initComponent:function(){var me=this;Ext.applyIf(me,{layout:"screen"});if(me.layout==="screen")Ext.applyIf(me,{activeItem:0});if(!me.initialConfig.items)me.initialConfig.items=me.items;Ext.trick.ScreenPanel.superclass.initComponent.call(this)},add:function(comp,num){var me=this;me.initItems();var args=arguments.length>1;if(args||Ext.isArray(comp)){var result=[];Ext.each(args?arguments:comp,function(c,num){if(num==me.activeItem||c.id==me.activeItem)result.push(me.add(c))},
me);return result}var c=me.lookupComponent(me.applyDefaults(comp));var index=this.items.length;if(me.fireEvent("beforeadd",me,c,index)!==false&&me.onBeforeAdd(c)!==false){me.items.add(c);c.onAdded(me,index);me.onAdd(c);me.fireEvent("add",me,c,index)}return c}});Ext.reg("screen",Ext.trick.ScreenPanel);Ext.trick.TrickPanel=Ext.extend(Ext.Panel,{trick:null,trickConfig:{},trickPartsConfig:{},initComponent:function(){var me=this;Ext.applyIf(me,{id:Ext.id()});if(me.trick){var parts={};Ext.applyIf(parts,{itemId:me.id+"_trickParts",xtype:"trick-"+(me.initialConfig.trick||me.trick),border:false,trickConfig:me.trickConfig});Ext.applyIf(me,{layout:"fit",items:parts})}Ext.trick.TrickPanel.superclass.initComponent.call(me)},initEvents:function(){var me=this;me.on("afterrender",me.onAfterRender,me);Ext.trick.TrickPanel.superclass.initEvents.apply(me,
arguments)},onAfterRender:function(){var me=this;me.trickParts=me.getComponent(me.id+"_trickParts")}});Ext.reg("trick",Ext.trick.TrickPanel);Ext.ns("Ext.trick","Ext.trick.parts");
Ext.trick.parts.ListUnitPanel=Ext.extend(Ext.trick.ScreenPanel,{initConfig:function(){var me=this;var config=me.trickConfig||{};config.list=config.list||{};config.unit=config.unit||{};var listConfig=config.list;var unitConfig=config.unit;if(listConfig.tbar)if(Ext.isObject(listConfig.tbar))listConfig.tbar=[listConfig.tbar];else{if(Ext.isArray(listConfig.tbar))listConfig.tbar=listConfig.tbar}else listConfig.tbar=[];listConfig.grid=listConfig.grid||{};listConfig.grid.sm=listConfig.grid.sm||{};if(config.mode===
"view"){listConfig.tbar=listConfig.tbar.concat([{itemId:"btnView",text:"\u8a73\u7d30\u8868\u793a",iconCls:"tx-icon-detailview",disabled:true,handler:me.onBtnView,scope:me}]);Ext.applyIf(listConfig.grid,{listeners:{dblclick:{fn:me.onBtnView,scope:me}}});Ext.applyIf(listConfig.grid.sm,{singleSelect:true,listeners:{rowselect:{fn:function(){var list=me.getComponent("listpanel");var btnView=me.panels.list.getTopToolbar().getComponent("btnView");var grid=me.panels.list.panels.grid;var sm=grid.getSelectionModel();
var selection=sm.getSelections();if(selection&&Ext.isArray(selection)&&selection.length>0)btnView.enable()},scope:me},rowdeselect:{fn:function(){var list=me.getComponent("listpanel");var btnView=me.panels.list.getTopToolbar().getComponent("btnView");var grid=me.panels.list.panels.grid;var sm=grid.getSelectionModel();var selection=sm.getSelections();if(selection&&Ext.isArray(selection)&&selection.length===0)btnView.disable()}}}})}else if(config.mode==="edit"){listConfig.tbar=listConfig.tbar.concat([{itemId:"btnAppend",
text:"\u65b0\u898f\u8ffd\u52a0",iconCls:"tx-icon-append",handler:me.onBtnAppend,scope:me},{itemId:"btnEdit",text:"\u7de8\u96c6",iconCls:"tx-icon-edit",disabled:true,handler:me.onBtnEdit,scope:me},{itemId:"btnRemove",text:"\u524a\u9664",iconCls:"tx-icon-remove",disabled:true,handler:me.onBtnRemove,scope:me}]);Ext.applyIf(listConfig.grid,{listeners:{dblclick:{fn:me.onBtnEdit,scope:me}}});Ext.applyIf(listConfig.grid.sm,{singleSelect:true,listeners:{rowselect:{fn:function(){var list=me.getComponent("listpanel");
var btnEdit=me.panels.list.getTopToolbar().getComponent("btnEdit");var btnRemove=me.panels.list.getTopToolbar().getComponent("btnRemove");var grid=me.panels.list.panels.grid;var sm=grid.getSelectionModel();var selection=sm.getSelections();if(selection&&Ext.isArray(selection)&&selection.length>0){btnEdit.enable();btnRemove.enable()}},scope:me},rowdeselect:{fn:function(){var list=me.getComponent("listpanel");var btnEdit=me.panels.list.getTopToolbar().getComponent("btnEdit");var btnRemove=me.panels.list.getTopToolbar().getComponent("btnRemove");
var grid=me.panels.list.panels.grid;var sm=grid.getSelectionModel();var selection=sm.getSelections();if(selection&&Ext.isArray(selection)&&selection.length===0){btnEdit.disable();btnRemove.disable()}}}}})}Ext.applyIf(unitConfig,{mode:config.mode})},initComponent:function(){var me=this,config=me.trickConfig||{};Ext.applyIf(me,{id:Ext.id()});me.initConfig();var tempConfig=config;var listeners={backlist:{fn:function(){me.layout.setActiveItem(0)},scope:me}};if(config.mode==="view")listeners.show={fn:me.onShowDetail,
scope:me};else if(config.mode==="edit")listeners.show={fn:me.onShowEdit,scope:me};tempConfig={cls:"tx-unit",xtype:"screen",border:false,items:[{itemId:"listpanel",ref:"panels.list",fix:true,border:false,xtype:config.listXType||"trick-list",trickConfig:config.list},{id:me.id+"_UNIT",itemId:"unitpanel",ref:"panels.unit",border:false,xtype:config.unitXType||"trick-unit",listeners:listeners,trickConfig:config.unit}]};Ext.applyIf(me,tempConfig);Ext.trick.parts.ListUnitPanel.superclass.initComponent.call(me)},
onBtnView:function(){var me=this;me.layout.setActiveItem(me.id+"_UNIT")},onBtnAppend:function(){var me=this;var sm=me.panels.list.panels.grid.getSelectionModel();sm.clearSelections();me.layout.setActiveItem(me.id+"_UNIT")},onBtnEdit:function(){var me=this;me.layout.setActiveItem(me.id+"_UNIT")},onBtnRemove:function(){var me=this,grid=me.panels.list.panels.grid,store=grid.store,sm=grid.getSelectionModel(),btnRemove=me.panels.list.getTopToolbar().getComponent("btnRemove"),btnEdit=me.panels.list.getTopToolbar().getComponent("btnEdit");
if(sm.getCount()>0){var r=sm.getSelected();Ext.Msg.confirm("\u78ba\u8a8d","\u9078\u629e\u3055\u308c\u305f\u30a2\u30a4\u30c6\u30e0\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f",function(btn){if(btn==="yes"){btnRemove.disable();btnEdit.disable();me.body.mask();OmegaTrick_List.removeUnit(r.get("id"),function(){store.reload({callback:function(){me.body.unmask()},scope:me})},me)}},me)}},onShowDetail:function(p){var me=this,grid=me.panels.list.panels.grid,sm=grid.getSelectionModel();p.loadData(sm.getSelected(),
grid.store)},onShowEdit:function(p){var me=this,grid=me.panels.list.panels.grid,sm=grid.getSelectionModel();p.loadData(sm.getSelected(),grid.store)}});Ext.reg("trick-listunit",Ext.trick.parts.ListUnitPanel);Ext.ns("Ext.trick","Ext.trick.parts");
Ext.trick.parts.SearchDetailPanel=Ext.extend(Ext.trick.form.FormPanel,{initComponent:function(){var me=this;Ext.applyIf(me,{height:135,padding:10,style:{borderBottom:"1px solid #D0D0D0"},layout:"hbox",layoutConfig:{align:"stretch",pack:"start"},items:[{layout:"form",items:[{itemId:"caption",xtype:"textfield",fieldLabel:"\u30bf\u30a4\u30c8\u30eb",anchor:"100%"},{itemId:"modified",xtype:"compositefield",fieldLabel:"\u66f4\u65b0\u65e5\u6642",items:[{itemId:"fromDate",xtype:"datefield",listeners:{select:{fn:function(field,
date){if(me.forms.modified.forms.fromHour.getValue()==""&&me.forms.modified.forms.fromMinute.getValue()==""&&me.forms.modified.forms.fromSecond.getValue()==""){me.forms.modified.forms.fromHour.setValue("00");me.forms.modified.forms.fromMinute.setValue("00");me.forms.modified.forms.fromSecond.setValue("00")}},scope:me}},width:100},{itemId:"fromHour",xtype:"combo",store:Ext.trick.store.Hour,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>",
"</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"fromMinute",xtype:"combo",store:Ext.trick.store.Minute,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",
mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"fromSecond",xtype:"combo",store:Ext.trick.store.Second,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",
width:40},{xtype:"displayfield",value:"\u301c",width:10},{itemId:"toDate",xtype:"datefield",listeners:{select:{fn:function(field,date){if(me.forms.modified.forms.toHour.getValue()==""&&me.forms.modified.forms.toMinute.getValue()==""&&me.forms.modified.forms.toSecond.getValue()==""){me.forms.modified.forms.toHour.setValue("23");me.forms.modified.forms.toMinute.setValue("59");me.forms.modified.forms.toSecond.setValue("59")}},scope:me}},width:100},{itemId:"toHour",xtype:"combo",store:Ext.trick.store.Hour,
tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"toMinute",xtype:"combo",store:Ext.trick.store.Minute,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>",
"<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"toSecond",xtype:"combo",store:Ext.trick.store.Second,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,
displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40}]},{itemId:"created",xtype:"compositefield",fieldLabel:"\u4f5c\u6210\u65e5\u6642",items:[{itemId:"fromDate",xtype:"datefield",listeners:{select:{fn:function(field,date){if(me.forms.created.forms.fromHour.getValue()==""&&me.forms.created.forms.fromMinute.getValue()==""&&me.forms.created.forms.fromSecond.getValue()==""){me.forms.created.forms.fromHour.setValue("00");me.forms.created.forms.fromMinute.setValue("00");
me.forms.created.forms.fromSecond.setValue("00")}},scope:me}},width:100},{itemId:"fromHour",xtype:"combo",store:Ext.trick.store.Hour,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"fromMinute",
xtype:"combo",store:Ext.trick.store.Minute,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"fromSecond",xtype:"combo",store:Ext.trick.store.Second,tpl:['<tpl for=".">','<div class="x-combo-list-item">',
"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:"\u301c",width:10},{itemId:"toDate",xtype:"datefield",listeners:{select:{fn:function(field,date){if(me.forms.created.forms.toHour.getValue()==""&&me.forms.created.forms.toMinute.getValue()==""&&me.forms.created.forms.toSecond.getValue()==
""){me.forms.created.forms.toHour.setValue("23");me.forms.created.forms.toMinute.setValue("59");me.forms.created.forms.toSecond.setValue("59")}},scope:me}},width:100},{itemId:"toHour",xtype:"combo",store:Ext.trick.store.Hour,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",
selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},{itemId:"toMinute",xtype:"combo",store:Ext.trick.store.Minute,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40},{xtype:"displayfield",value:":",width:5},
{itemId:"toSecond",xtype:"combo",store:Ext.trick.store.Second,tpl:['<tpl for=".">','<div class="x-combo-list-item">',"<tpl if=display.length &gt; 1>{display}</tpl>","<tpl if=display.length == 0>&nbsp;</tpl>","</div>","</tpl>"].join(""),editable:false,displayField:"display",valueField:"value",mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,value:"",width:40}]},{border:false,baseCls:"x-plain",style:"padding-top: 10px;",items:[{xtype:"button",style:"float: right",width:100,text:"\u691c\u7d22",
handler:me.onBtnSearch,scope:me},{xtype:"displayfield",value:" ",style:"float:right",width:5},{xtype:"button",style:"float: right",width:100,text:"\u30af\u30ea\u30a2",handler:me.onBtnReset,scope:me}]}],width:635},{flex:1}]});me.cls=me.cls||"";me.cls+=" tx-searchdetail";Ext.trick.parts.SearchDetailPanel.superclass.initComponent.call(me)},onBtnReset:function(){var me=this;me.forms.caption.setValue("");me.forms.modified.reset();me.forms.created.reset()},onBtnSearch:function(){var me=this,store=me.searchStore,
lastOptions=store.lastOptions;var query={},modFromDate=me.forms.modified.forms.fromDate.getRawValue(),modFromHour=me.forms.modified.forms.fromHour.getRawValue(),modFromMinute=me.forms.modified.forms.fromMinute.getRawValue(),modFromSecond=me.forms.modified.forms.fromSecond.getRawValue(),modToDate=me.forms.modified.forms.toDate.getRawValue(),modToHour=me.forms.modified.forms.toHour.getRawValue(),modToMinute=me.forms.modified.forms.toMinute.getRawValue(),modToSecond=me.forms.modified.forms.toSecond.getRawValue();
createdFromDate=me.forms.created.forms.fromDate.getRawValue(),createdFromHour=me.forms.created.forms.fromHour.getRawValue(),createdFromMinute=me.forms.created.forms.fromMinute.getRawValue(),createdFromSecond=me.forms.created.forms.fromSecond.getRawValue(),createdToDate=me.forms.created.forms.toDate.getRawValue(),createdToHour=me.forms.created.forms.toHour.getRawValue(),createdToMinute=me.forms.created.forms.toMinute.getRawValue(),createdToSecond=me.forms.created.forms.toSecond.getRawValue();if(me.forms.caption.getValue().length>
0)query.caption=me.forms.caption.getValue();if(modFromDate!=""&&modFromHour!=""&&modFromMinute!=""&&modFromSecond!=""){query.modified=query.modified||{};query.modified.from=modFromDate+" "+modFromHour+":"+modFromMinute+":"+modFromSecond}if(modToDate!=""&&modToHour!=""&&modToMinute!=""&&modToSecond!=""){query.modified=query.modified||{};query.modified.to=modToDate+" "+modToHour+":"+modToMinute+":"+modToSecond}if(createdFromDate!=""&&createdFromHour!=""&&createdFromMinute!=""&&createdFromSecond!=""){query.created=
query.created||{};query.created.from=createdFromDate+" "+createdFromHour+":"+createdFromMinute+":"+createdFromSecond}if(createdToDate!=""&&createdToHour!=""&&createdToMinute!=""&&createdToSecond!=""){query.created=query.created||{};query.created.to=createdToDate+" "+createdToHour+":"+createdToMinute+":"+createdToSecond}var hasQuery=false;Ext.iterate(query,function(){hasQuery=true;return false});if(!hasQuery)query="";if(!lastOptions.params)lastOptions.params=Ext.clone(store.baseParams);Ext.apply(lastOptions.params,
{query:query});store.reload(lastOptions)}});Ext.reg("trick-searchdetail",Ext.trick.parts.SearchDetailPanel);Ext.ns("Ext.trick","Ext.trick.parts");
Ext.trick.parts.ListPanel=Ext.extend(Ext.Panel,{initConfig:function(){var me=this,config=me.trickConfig||{};Ext.applyIf(config,{store:{},colModel:{},grid:{}});Ext.applyIf(config.store,{directFn:config.store.directFn||OmegaTrick_List.readList,restful:config.store.restful||true,autoLoad:config.store.autoLoad||true,paramOrder:config.store.paramOrder||"start|limit|sort|dir|query",remoteSort:config.store.remoteSotr||true,paramsAsHash:config.store.paramsAsHash||false,idProperty:config.store.idProperty||
"id",root:config.store.root||"items",baseParams:config.store.baseParams||{start:0,limit:50,sort:"modified",dir:"DESC",query:""},fields:config.store.fields||["id","caption",{name:"modified",type:"date",dateFormat:"Y-m-d h:i:s"},{name:"created",type:"date",dateFormat:"Y-m-d h:i:s"}]});Ext.applyIf(config.colModel,{defaults:config.colModel.defaults||{width:120,sortable:true},columns:config.colModel.columns||[{header:"\u30bf\u30a4\u30c8\u30eb",width:200,sortable:true,dataIndex:"caption"},{header:"\u66f4\u65b0\u65e5\u6642",
width:200,sortable:true,dataIndex:"modified",renderer:Ext.util.Format.dateRenderer("Y/m/d H:i:s")},{header:"\u4f5c\u6210\u65e5\u6642",width:200,sortable:true,dataIndex:"created",renderer:Ext.util.Format.dateRenderer("Y/m/d H:i:s")}]});if(config.ptbar)Ext.applyIf(config.ptbar,{paseSize:50,displayInfo:true,displayMsg:"\u8868\u793a\u4e2d\u306e\u30a2\u30a4\u30c6\u30e0: {2} \u4ef6\u4e2d {0} - {1} \u4ef6",emptyMsg:"\u8868\u793a\u3059\u308b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\u3002"})},
initComponent:function(){var me=this,config=me.trickConfig||{},storeCls=config.storeCls||Ext.data.DirectStore,colModelCls=config.colModelCls||Ext.grid.ColumnModel;smCls=config.smCls||Ext.grid.RowSelectionModel;Ext.applyIf(me,{id:Ext.id()});me.initConfig();var store=new storeCls(config.store);var gridConfig=config.gird||{};Ext.applyIf(gridConfig,{itemId:"grid",ref:"panels.grid",xtype:"grid",border:false,style:{borderTop:"1px solid #D0D0D0"},store:store,colModel:new colModelCls(config.colModel),listeners:config.grid.listeners||
{},sm:new smCls(config.grid.sm)});var tempConfig={layout:"fit",cls:"tx-list",items:[gridConfig]};if(config.searchBox){tempConfig.layout="border";gridConfig.region="center";var detailXType="trick-searchdetail";if(Ext.isObject(config.searchBox)&&config.searchBox.xtype)detailXType=config.searchBox.xtype;tempConfig.items.push({itemId:me.id+"_SearchDetail",searchStore:store,region:"north",border:false,xtype:detailXType,animCollapse:config.searchBox.anim===true||false,collapseMode:"mini",split:true,collapsed:true,
listeners:{beforeexpand:{fn:function(){var dsb=me.getTopToolbar().getComponent("btnSearchDetail");var sf=me.getTopToolbar().getComponent("SearchFiled");var sl=me.getTopToolbar().getComponent("SearchLabelText");var sdp=me.getComponent(me.id+"_SearchDetail");sf.disable();dsb.toggle(true,true);sl.addClass("tx-text-disable");sl.removeClass("tx-text-enable")}},expand:{fn:function(){var sdp=me.getComponent(me.id+"_SearchDetail");sdp.doLayout()}},beforecollapse:{fn:function(){var dsb=me.getTopToolbar().getComponent("btnSearchDetail");
var sf=me.getTopToolbar().getComponent("SearchFiled");var sl=me.getTopToolbar().getComponent("SearchLabelText");var sdp=me.getComponent(me.id+"_SearchDetail");dsb.toggle(false,true);sf.enable();sl.addClass("tx-text-enable");sl.removeClass("tx-text-disable")}}}});var searchBoxTbar=[{itemId:"SearchLabelText",xtype:"tbtext",text:"\u691c\u7d22:"},new Ext.ux.form.SearchField({itemId:"SearchFiled",width:240,store:store}),"-",{itemId:"btnSearchDetail",iconCls:"tx-icon-searchdetail",enableToggle:true,text:"\u8a73\u7d30\u691c\u7d22",
ref:"../searchBox.btnSearchDetail",toggleHandler:function(button,state){var sf=me.getTopToolbar().getComponent("SearchFiled");var sdp=me.getComponent(me.id+"_SearchDetail");if(state){sf.disable();sdp.expand()}else{sf.enable();sdp.collapse()}me.fireEvent("toggleSearchDetail",state)},scope:me}];if(Ext.isObject(config.tbar))serachBoxTbar=[config.tbar,{xtype:"tbseparator"}].concat(searchBoxTbar);else if(Ext.isArray(config.tbar))searchBoxTbar=config.tbar.concat([{xtype:"tbseparator"}]).concat(searchBoxTbar);
Ext.apply(me,{searchBox:{},tbar:searchBoxTbar})}if(config.ptbar){Ext.applyIf(config.ptbar,{store:store});var pos=config.ptbar.position;if(pos==="top")tempConfig.tbar=new Ext.PagingToolbar(config.ptbar);else if(pos=="bottom")tempConfig.bbar=new Ext.PagingToolbar(config.ptbar);else if(pos.both&&Ext.isObject(pos.both))if(pos.both.top===true&&pos.both.bottom!==true){config.ptbar.listeners=config.ptbar.listeners||{};config.ptbar.listeners.change={fn:function(){var pt=me.getTopToolbar(),bbar=me.getBottomToolbar(),
count=pt.store.getCount(),info=bbar.getComponent("ptbar_info");var msg=count==0?pt.emptyMsg:String.format(pt.displayMsg,pt.cursor+1,pt.cursor+count,pt.store.getTotalCount());info.setText(msg)}};tempConfig.tbar=new Ext.PagingToolbar(config.ptbar);if(!me.bbar)me.bbar=[];me.bbar.push("->");me.bbar.push({xtype:"tbtext",itemId:"ptbar_info"})}else if(pos.both.top!==true&&pos.both.bottom===true){config.ptbar.listeners=config.ptbar.listeners||{};config.ptbar.listeners.change={fn:function(){var pt=me.getBottomToolbar(),
tbar=me.getTopToolbar(),count=pt.store.getCount(),info=tbar.getComponent("ptbar_info");var msg=count==0?pt.emptyMsg:String.format(pt.displayMsg,pt.cursor+1,pt.cursor+count,pt.store.getTotalCount());info.setText(msg)}};tempConfig.bbar=new Ext.PagingToolbar(config.ptbar);if(!me.tbar)me.tbar=[];me.tbar.push("->");me.tbar.push({xtype:"tbtext",itemId:"ptbar_info"})}else{tempConfig.tbar=new Ext.PagingToolbar(config.ptbar);tempConfig.bbar=new Ext.PagingToolbar(config.ptbar)}else{tempConfig.tbar=new Ext.PagingToolbar(config.ptbar);
tempConfig.bbar=new Ext.PagingToolbar(config.ptbar)}}Ext.applyIf(me,tempConfig);Ext.trick.parts.ListPanel.superclass.initComponent.call(me)},initEvents:function(){var me=this;me.on("afterrender",me.onAfterRender,me);Ext.trick.parts.ListPanel.superclass.initEvents.apply(me,arguments)},onAfterRender:function(){var me=this}});Ext.reg("trick-list",Ext.trick.parts.ListPanel);Ext.ns("Ext.trick","Ext.trick.parts");
Ext.trick.parts.UnitPanel=Ext.extend(Ext.trick.form.FormPanel,{baseRecord:null,initConfig:function(){var me=this,config=me.trickConfig;Ext.applyIf(me,config);if(Ext.isObject(me.tbar))me.tbar=[me.tbar];else if(Ext.isArray(me.tbar))me.tbar=me.tbar;else me.tbar=[];me.tbar=me.tbar.concat([{text:"\u4e00\u89a7\u3078\u623b\u308b",iconCls:"tx-icon-backlist",handler:function(){if(!me.baseRecord.dirty)me.store.reload({callback:function(){me.fireEvent("backlist")},scope:me});else Ext.Msg.confirm("\u78ba\u8a8d",
"\u5185\u5bb9\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u307e\u3059\u3002<br>\u5185\u5bb9\u3092\u7834\u68c4\u3057\u3066\u4e00\u89a7\u3078\u623b\u308a\u307e\u3059\u304b\uff1f",function(btn){if(btn==="yes")me.store.reload({callback:function(){me.fireEvent("backlist")},scope:me})})},scope:me}]);if(config.mode==="edit")me.tbar=me.tbar.concat(["-",{itemId:"btnSave",text:"\u4fdd\u5b58",iconCls:"tx-icon-save",disabled:true,handler:me.onSave,scope:me},{itemId:"btnPageSave",text:"\u4fdd\u5b58\u3057\u3066\u7de8\u96c6\u3092\u7d9a\u3051\u308b",
iconCls:"tx-icon-pagesave",disabled:true,handler:me.onPageSave,scope:me}])},initComponent:function(){var me=this;me.initConfig();Ext.apply(me,{cls:"tx-unit"});if(me.mode==="view")Ext.applyIf(me,{padding:20,items:[{itemId:"caption",xtype:"displayfield",fieldLabel:"\u30bf\u30a4\u30c8\u30eb"},{itemId:"modified",xtype:"displayfield",fieldLabel:"\u66f4\u65b0\u65e5\u6642"},{itemId:"created",xtype:"displayfield",fieldLabel:"\u4f5c\u6210\u65e5\u6642"}]});else if(me.mode==="edit")Ext.applyIf(me,{padding:20,
items:[{itemId:"caption",xtype:"textfield",enableKeyEvents:true,listeners:{keyup:{fn:function(field,e){var btnSave=me.getTopToolbar().getComponent("btnSave");var btnPageSave=me.getTopToolbar().getComponent("btnPageSave");me.baseRecord.set("caption",field.getValue());if(me.baseRecord.dirty){btnSave.enable();btnPageSave.enable();Ext.trick.app.Entry.setLeaveMessage("\u60c5\u5831\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u307e\u3059\u3002")}else{btnSave.disable();btnPageSave.disable()}},scope:me}},fieldLabel:"\u30bf\u30a4\u30c8\u30eb"},
{itemId:"modified",xtype:"textfield",enableKeyEvents:true,listeners:{keyup:{fn:function(field,e){var btnSave=me.getTopToolbar().getComponent("btnSave");var btnPageSave=me.getTopToolbar().getComponent("btnPageSave");me.baseRecord.set("modified",field.getRawValue());if(me.baseRecord.dirty){btnPageSave.enable();btnSave.enable()}else{btnSave.disable();btnPageSave.disable()}},scope:me}},fieldLabel:"\u66f4\u65b0\u65e5\u6642"},{itemId:"created",xtype:"textfield",enableKeyEvents:true,listeners:{keyup:{fn:function(field,
e){var btnSave=me.getTopToolbar().getComponent("btnSave");var btnPageSave=me.getTopToolbar().getComponent("btnPageSave");me.baseRecord.set("created",field.getRawValue());if(me.baseRecord.dirty){btnPageSave.enable();btnSave.enable()}else{btnSave.disable();btnPageSave.disable()}},scope:me}},fieldLabel:"\u4f5c\u6210\u65e5\u6642"}]});Ext.trick.parts.UnitPanel.superclass.initComponent.call(me)},initEvents:function(){var me=this;Ext.trick.parts.UnitPanel.superclass.initEvents.apply(me,arguments)},loadData:function(r,
store){var me=this;me.store=store;if(r){me.ownerCt.body.mask();OmegaTrick_List.getUnit(r.id,function(ret){me.forms.caption.setValue(ret.caption);me.forms.modified.setValue(ret.modified);me.forms.created.setValue(ret.created);me.baseRecord=new store.recordType(ret);me.ownerCt.body.unmask()},me)}else me.baseRecord=new store.recordType({caption:"",modified:"",created:""})},onSave:function(){var me=this;me.ownerCt.body.mask();OmegaTrick_List.setUnit({id:me.baseRecord.get("id"),caption:me.baseRecord.get("caption"),
modified:me.baseRecord.get("modified"),created:me.baseRecord.get("created")},function(ret){me.baseRecord=new me.store.recordType(ret.data);Ext.trick.app.Entry.setLeaveMessage(false);var btnSave=me.getTopToolbar().getComponent("btnSave");var btnPageSave=me.getTopToolbar().getComponent("btnPageSave");btnSave.disable();btnPageSave.disable();me.store.reload({callback:function(){me.fireEvent("backlist")},scope:me});me.ownerCt.body.unmask()},me)},onPageSave:function(){var me=this;me.ownerCt.body.mask();
OmegaTrick_List.setUnit({id:me.baseRecord.get("id"),caption:me.baseRecord.get("caption"),modified:me.baseRecord.get("modified"),created:me.baseRecord.get("created")},function(ret){me.baseRecord=new me.store.recordType(ret.data);Ext.trick.app.Entry.setLeaveMessage(false);var btnSave=me.getTopToolbar().getComponent("btnSave");var btnPageSave=me.getTopToolbar().getComponent("btnPageSave");btnSave.disable();btnPageSave.disable();me.ownerCt.body.unmask()},me)}});Ext.reg("trick-unit",Ext.trick.parts.UnitPanel);Ext.ns("Ext.trick");Ext.trick.Config=function(){var testingFrameworkName="yui";var defaults={useHistory:{tokenDelimiter:":"}};return{getDefault:function(key){if(defaults[key])return defaults[key];return undefined},getTestingFrameworkName:function(){return testingFrameworkName},setTestingFrameworkName:function(name){testingFrameworkName=name}}}();Ext.ns("Ext.trick","Ext.trick.store");Ext.trick.store.Hour=new Ext.data.ArrayStore({storeId:"TrickHourStore",fields:["display","value"],data:[["",""],["00","00"],["01","01"],["02","02"],["03","03"],["04","04"],["05","05"],["06","06"],["07","07"],["08","08"],["09","09"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"]]});
Ext.trick.store.Minute=new Ext.data.ArrayStore({storeId:"TrickMinuteStore",fields:["display","value"],data:[["",""],["00","00"],["01","01"],["02","02"],["03","03"],["04","04"],["05","05"],["06","06"],["07","07"],["08","08"],["09","09"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"],["24","24"],["25","25"],["26","26"],["27","27"],["28","28"],["29","29"],["30","30"],["31","31"],["32",
"32"],["33","33"],["34","34"],["35","35"],["36","36"],["37","37"],["38","38"],["39","39"],["40","40"],["41","41"],["42","42"],["43","43"],["44","44"],["45","45"],["46","46"],["47","47"],["48","48"],["49","49"],["50","50"],["51","51"],["52","52"],["53","53"],["54","54"],["55","55"],["56","56"],["57","57"],["58","58"],["59","59"]]});
Ext.trick.store.Second=new Ext.data.ArrayStore({storeId:"TrickSecondStore",fields:["display","value"],data:[["",""],["00","00"],["01","01"],["02","02"],["03","03"],["04","04"],["05","05"],["06","06"],["07","07"],["08","08"],["09","09"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"],["24","24"],["25","25"],["26","26"],["27","27"],["28","28"],["29","29"],["30","30"],["31","31"],["32",
"32"],["33","33"],["34","34"],["35","35"],["36","36"],["37","37"],["38","38"],["39","39"],["40","40"],["41","41"],["42","42"],["43","43"],["44","44"],["45","45"],["46","46"],["47","47"],["48","48"],["49","49"],["50","50"],["51","51"],["52","52"],["53","53"],["54","54"],["55","55"],["56","56"],["57","57"],["58","58"],["59","59"]]});String.prototype.endsWith=function(suffix){var sub=this.length-suffix.length;return sub>=0&&this.lastIndexOf(suffix)===sub};String.prototype.startsWith=function(prefix){return this.indexOf(prefix)===0};String.prototype.capitalize=function(){return this.replace(/\w+/g,function(word){return word.charAt(0).toUpperCase()+word.substr(1).toLowerCase()})};Ext.applyIf(Ext,{maxZindex:function(){var ret=0;var els=Ext.select("*");els.each(function(el){var zIndex=el.getStyle("z-index");if(Ext.isNumber(parseInt(zIndex,10))&&ret<zIndex)ret=zIndex},this);return ret},getScrollPos:function(){var y=document.documentElement.scrollTop>0?document.documentElement.scrollTop:document.body.scrollTop;var x=document.documentElement.scrollLeft>0?document.documentElement.scrollLeft:document.body.scrollLeft;return{x:x,y:y}},clone:function(o){return Ext.trick.util.Clone(o)}});
